<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><p><a href="https://forge.puppetlabs.com/herculesteam/augeasproviders_grub"><img src="http://img.shields.io/puppetforge/v/herculesteam/augeasproviders_grub.svg" alt="Puppet Forge Version" /></a>
<a href="https://forge.puppetlabs.com/herculesteam/augeasproviders_grub"><img src="http://img.shields.io/puppetforge/dt/herculesteam/augeasproviders_grub.svg" alt="Puppet Forge Downloads" /></a>
<a href="https://forge.puppetlabs.com/herculesteam/augeasproviders_grub"><img src="https://img.shields.io/puppetforge/e/herculesteam/augeasproviders_grub.svg" alt="Puppet Forge Endorsement" /></a>
<a href="https://travis-ci.org/hercules-team/augeasproviders_grub"><img src="https://img.shields.io/travis/hercules-team/augeasproviders_grub/master.svg" alt="Build Status" /></a>
<a href="https://coveralls.io/r/hercules-team/augeasproviders_grub"><img src="https://img.shields.io/coveralls/hercules-team/augeasproviders_grub.svg" alt="Coverage Status" /></a>
<a href="https://gemnasium.com/hercules-team/augeasproviders_grub"><img src="https://img.shields.io/gemnasium/hercules-team/augeasproviders_grub.svg" alt="Gemnasium" /></a></p>

<h1 id="grub-typeprovider-for-grub-files-for-puppet">grub: type/provider for grub files for Puppet</h1>

<p>This module provides a new type/provider for Puppet to read and modify grub
config files using the Augeas configuration library.</p>

<p>The advantage of using Augeas over the default Puppet <code>parsedfile</code>
implementations is that Augeas will go to great lengths to preserve file
formatting and comments, while also failing safely when needed.</p>

<p>This provider will hide <em>all</em> of the Augeas commands etc., you don’t need to
know anything about Augeas to make use of it.</p>

<h2 id="requirements">Requirements</h2>

<p>Ensure both Augeas and ruby-augeas 0.3.0+ bindings are installed and working as
normal.</p>

<p>See <a href="http://docs.puppetlabs.com/guides/augeas.html#pre-requisites">Puppet/Augeas pre-requisites</a>.</p>

<h2 id="installing">Installing</h2>

<p>On Puppet 2.7.14+, the module can be installed easily (<a href="http://docs.puppetlabs.com/puppet/latest/reference/modules_installing.html">documentation</a>):</p>

<pre class="code ruby"><code class="ruby">puppet module install herculesteam/augeasproviders_grub
</code></pre>

<p>You may see an error similar to this on Puppet 2.x (<a href="http://projects.puppetlabs.com/issues/13858">#13858</a>):</p>

<pre class="code ruby"><code class="ruby">Error 400 on SERVER: Puppet::Parser::AST::Resource failed with error ArgumentError: Invalid resource type `kernel_parameter` at ...
</code></pre>

<p>Ensure the module is present in your puppetmaster’s own environment (it doesn’t
have to use it) and that the master has pluginsync enabled.  Run the agent on
the puppetmaster to cause the custom types to be synced to its local libdir
(<code>puppet master --configprint libdir</code>) and then restart the puppetmaster so it
loads them.</p>

<h2 id="compatibility">Compatibility</h2>

<h3 id="puppet-versions">Puppet versions</h3>

<p>Minimum of Puppet 2.7.</p>

<h3 id="augeas-versions">Augeas versions</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Augeas Versions</th>
      <th style="text-align: center">0.10.0</th>
      <th style="text-align: center">1.0.0</th>
      <th style="text-align: center">1.1.0</th>
      <th style="text-align: center">1.2.0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>PROVIDERS</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left">kernel_parameter (grub)</td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
    </tr>
    <tr>
      <td style="text-align: left">kernel_parameter (grub2)</td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
    </tr>
    <tr>
      <td style="text-align: left">grub_config (grub)</td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
    </tr>
    <tr>
      <td style="text-align: left">grub_config (grub2)</td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
    </tr>
    <tr>
      <td style="text-align: left">grub_menuentry (grub)</td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
      <td style="text-align: center"><strong>yes</strong></td>
    </tr>
    <tr>
      <td style="text-align: left">grub_menuentry (grub2)</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">N/A</td>
    </tr>
    <tr>
      <td style="text-align: left">grub_user (grub2)</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">N/A</td>
      <td style="text-align: center">N/A</td>
    </tr>
  </tbody>
</table>

<p><strong>Note</strong>: grub_menuentry and grub_user for GRUB2 do not use Augeas at this
time due to lack of available lenses.</p>

<h2 id="documentation-and-examples">Documentation and examples</h2>

<p>Type documentation can be generated with <code>puppet doc -r type</code> or viewed on the
<a href="http://forge.puppetlabs.com/herculesteam/augeasproviders_grub">Puppet Forge page</a>.</p>

<h3 id="kernelparameter-provider">kernel_parameter provider</h3>

<p>This is a custom type and provider supplied by <code>augeasproviders</code>.  It supports
both GRUB Legacy (0.9x) and GRUB 2 configurations.</p>

<h4 id="manage-parameter-without-value">manage parameter without value</h4>

<pre class="code ruby"><code class="ruby">kernel_parameter { &quot;quiet&quot;:
  ensure =&gt; present,
}
</code></pre>

<h4 id="manage-parameter-with-value">manage parameter with value</h4>

<pre class="code ruby"><code class="ruby">kernel_parameter { &quot;elevator&quot;:
  ensure  =&gt; present,
  value   =&gt; &quot;deadline&quot;,
}
</code></pre>

<h4 id="manage-parameter-with-multiple-values">manage parameter with multiple values</h4>

<pre class="code ruby"><code class="ruby">kernel_parameter { &quot;rd_LVM_LV&quot;:
  ensure  =&gt; present,
  value   =&gt; [&quot;vg/lvroot&quot;, &quot;vg/lvvar&quot;],
}
</code></pre>

<h4 id="manage-parameter-on-certain-boot-types">manage parameter on certain boot types</h4>

<p>Bootmode defaults to “all”, so settings are applied for all boot types usually.</p>

<p>Apply only to the default boot:</p>

<pre class="code ruby"><code class="ruby">kernel_parameter { &quot;quiet&quot;:
  ensure   =&gt; present,
  bootmode =&gt; &quot;default&quot;,
}
</code></pre>

<p>Apply only to normal boots. In GRUB legacy, normal boots consist of the default boot plus non-recovery ones. In GRUB2, normal bootmode is just an alias for default.</p>

<pre class="code ruby"><code class="ruby">kernel_parameter { &quot;quiet&quot;:
  ensure   =&gt; present,
  bootmode =&gt; &quot;normal&quot;,
}
</code></pre>

<p>Only recovery mode boots (unsupported with GRUB 2):</p>

<pre class="code ruby"><code class="ruby">kernel_parameter { &quot;quiet&quot;:
  ensure   =&gt; present,
  bootmode =&gt; &quot;recovery&quot;,
}
</code></pre>

<h4 id="delete-entry">delete entry</h4>

<pre class="code ruby"><code class="ruby">kernel_parameter { &quot;rhgb&quot;:
  ensure =&gt; absent,
}
</code></pre>

<h4 id="manage-parameter-in-another-config-location">manage parameter in another config location</h4>

<pre class="code ruby"><code class="ruby">kernel_parameter { &quot;elevator&quot;:
  ensure =&gt; present,
  value  =&gt; &quot;deadline&quot;,
  target =&gt; &quot;/mnt/boot/grub/menu.lst&quot;,
}
</code></pre>

<h3 id="grubconfig-provider">grub_config provider</h3>

<p>This custom type manages GRUB Legacy and GRUB2 global configuration parameters.</p>

<p>In GRUB Legacy, the global items at the top of the <code>grub.conf</code> file are managed.</p>

<p>In GRUB2, the parameters in <code>/etc/defaults/grub</code> are managed.</p>

<p>When using GRUB2, take care that you aren’t conflicting with an option later
specified by <code>grub_menuentry</code>. Also, be aware that, in GRUB2, any global items
here will not be referenced unless you reference them by variable name per Bash
semantics.</p>

<h4 id="change-the-default-legacy-grub-timeout">change the default legacy GRUB timeout</h4>

<p>This will set the <code>timeout</code> global value in the Legacy GRUB configuration.</p>

<pre class="code ruby"><code class="ruby">grub_config { &#39;timeout&#39;:
  value =&gt; &#39;1&#39;
}
</code></pre>

<h4 id="change-the-default-grub2-timeout">change the default GRUB2 timeout</h4>

<p>This will set the <code>GRUB_TIMEOUT</code> global value in the GRUB2 configuration.</p>

<pre class="code ruby"><code class="ruby">grub_config { &#39;GRUB_TIMEOUT&#39;:
  value =&gt; &#39;1&#39;
}
</code></pre>

<h3 id="grubmenuentry-provider">grub_menuentry provider</h3>

<p>This is a custom type to manage GRUB Legacy and GRUB2 menu entries.</p>

<p>The GRUB Legacy provider utlizes Augeas under the hood but GRUB2 did not have
an available Lens and was written in Ruby.</p>

<p>This will <strong>not</strong> allow for modifying dynamically generated system entries. You
will need to remove some of the native GRUB2 configuration scripts to be fully
independent of the default system values.</p>

<p>The GRUB2 output of this provider will be saved, by default, in
<code>/etc/grub.d/05_puppet_managed_&lt;random_string&gt;</code> where the <code>random_string</code> is a
hash of the resource <code>name</code>.</p>

<h4 id="new-entry-preserving-all-existing-values">new entry preserving all existing values</h4>

<p>This will create a new menu entry and copy over any default values if present.
If the entry currently exists, it will preserve all values and not overwrite
them with the default system values.</p>

<pre class="code ruby"><code class="ruby">grub_menuentry { &#39;new_entry&#39;:
  root           =&gt; &#39;(hd0,0)&#39;,
  kernel         =&gt; &#39;:preserve:&#39;,
  initrd         =&gt; &#39;:preserve:&#39;,
  kernel_options =&gt; [&#39;:preserve:&#39;]
}
</code></pre>

<h4 id="kernel-option-lines">kernel option lines</h4>

<p>There are many methods for identifying and manipulating kernel option lines and
so a method was developed for handling the most common scenarios. You can, of
course, simply denote every option, but this is cumbersome and prone to error
over time.</p>

<p>The following format is supported for the new options:</p>

<pre class="code ruby"><code class="ruby">&#39;:defaults:&#39;  =&gt; Copy defaults from the default GRUB entry
&#39;:preserve:&#39;  =&gt; Preserve all existing options (if present)

Note: &#39;:defaults:&#39; and &#39;:preserve:&#39; are mutually exclusive.

All of the options below supersede any items affected by the above

&#39;entry(=.*)?&#39;   =&gt; Ensure that `entry` exists *as entered*; replaces all
                   other options with the same name
&#39;!:entry(=.*)?&#39; =&gt; Add this option to the end of the arguments
                   preserving any other options of the same name
&#39;-:entry&#39;       =&gt; Ensure that all instances of `entry` do not exist
&#39;-:entry=foo&#39;   =&gt; Ensure that only instances of `entry` with value `foo` do not exist

Note: Option removals and additions have higher precedence than preservation
</code></pre>

<h3 id="grubuser-provider">grub_user provider</h3>

<p>This type manages GRUB2 users and superusers.</p>

<p>The output of this provider is stored, by default, in <code>/etc/grub.d/01_puppet_managed_users</code>.</p>

<p>Any plain text passwords are automatically converted into the appropriate GRUB
PBKDF2 format.</p>

<p>Note: If no users are defined as superusers, then GRUB2 will not enforce user
restrictions on your entries.</p>

<h4 id="user-with-a-plain-text-password">user with a plain text password</h4>

<pre class="code ruby"><code class="ruby">grub_user { &#39;test_user&#39;:
  password =&gt; &#39;plain text password&#39;
}
</code></pre>

<h4 id="user-with-a-pre-hashed-password">user with a pre-hashed password</h4>

<pre class="code ruby"><code class="ruby">grub_user { &#39;test_user&#39;:
  password =&gt; &#39;grub.pbkdf2.sha512.10000.REALLY_LONG_STRING&#39;
}
</code></pre>

<h4 id="user-that-is-a-superuser-with-a-plain-text-password-and-20000-rounds">user that is a superuser with a plain text password and 20000 rounds</h4>

<pre class="code ruby"><code class="ruby">grub_user { &#39;test_user&#39;:
  password  =&gt; &#39;plain text password&#39;,
  superuser =&gt; true,
  rounds    =&gt; &#39;20000&#39;
}
</code></pre>

<h2 id="issues">Issues</h2>

<p>Please file any issues or suggestions
<a href="https://github.com/hercules-team/augeasproviders_grub/issues">on GitHub</a>.</p>
</div></div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>