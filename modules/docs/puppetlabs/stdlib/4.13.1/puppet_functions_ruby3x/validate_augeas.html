<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Function: validate_augeas (Ruby 3.x API)
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_functions_ruby3x::validate_augeas";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_function_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (v)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Functions</span></span>
     &raquo; 
    <span class="title">validate_augeas</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Function: validate_augeas</h1>
<div class="box_info">
  <dl>
    <dt>Defined in:</dt>
    <dd>
      /tmp/tmp_git_repo20171214-12245-ju7he9/lib/puppet/parser/functions/validate_augeas.rb
    </dd>
  </dl>
  <dl>
    <dt>Function type:</dt>
    <dd>Ruby 3.x API</dd>
  </dl>
</div>

<h2>Overview</h2>
<div class="method_details first">
  
  <div class="tags overload overload_item">
    <span class="overload">
      <span class="overload_item">
        <span class="signature first" style="margin-left: 0px;"><strong>validate_augeas()</strong> &#x21d2; <tt>Any</tt> </span>
      </span>
    </span>
  </div>
  
  <div class="docstring">
    <div class="discussion">
      <p>Perform validation of a string using an Augeas lens
The first argument of this function should be a string to
test, and the second argument should be the name of the Augeas lens to use.
If Augeas fails to parse the string with the lens, the compilation will
abort with a parse error.</p>

<p>A third argument can be specified, listing paths which should
not be found in the file. The <code>$file</code> variable points to the location
of the temporary file being tested in the Augeas tree.</p>

<p>For example, if you want to make sure your passwd content never contains
a user <code>foo</code>, you could write:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_validate_augeas'>validate_augeas</span><span class='lparen'>(</span><span class='gvar'>$passwdcontent</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Passwd.lns</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$file/foo</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
</code></pre>

<p>Or if you wanted to ensure that no users used the ‘/bin/barsh’ shell,
you could use:</p>

<pre class="code ruby"><code class="ruby">validate_augeas($passwdcontent, &#39;Passwd.lns&#39;, [&#39;$file/*[shell=&quot;/bin/barsh&quot;]&#39;]
</code></pre>

<p>If a fourth argument is specified, this will be the error message raised and
seen by the user.</p>

<p>A helpful error message can be returned like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_validate_augeas'>validate_augeas</span><span class='lparen'>(</span><span class='gvar'>$sudoerscontent</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Sudoers.lns</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Failed to validate sudoers content with Augeas</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
</code></pre>

    </div>
  </div>
  <div class="tags">
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File '/tmp/tmp_git_repo20171214-12245-ju7he9/lib/puppet/parser/functions/validate_augeas.rb', line 4</span>

<span class='id identifier rubyid_newfunction'>newfunction</span><span class='lparen'>(</span><span class='symbol'>:validate_augeas</span><span class='comma'>,</span> <span class='symbol'>:doc</span> <span class='op'>=&gt;</span> <span class='heredoc_beg'>&lt;&lt;-&#39;ENDHEREDOC&#39;</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
  <span class='kw'>unless</span> <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_features'>features</span><span class='period'>.</span><span class='id identifier rubyid_augeas?'>augeas?</span>
<span class='tstring_content'>  Perform validation of a string using an Augeas lens
  The first argument of this function should be a string to
  test, and the second argument should be the name of the Augeas lens to use.
  If Augeas fails to parse the string with the lens, the compilation will
  abort with a parse error.

  A third argument can be specified, listing paths which should
  not be found in the file. The `$file` variable points to the location
  of the temporary file being tested in the Augeas tree.

  For example, if you want to make sure your passwd content never contains
  a user `foo`, you could write:

      validate_augeas($passwdcontent, &#39;Passwd.lns&#39;, [&#39;$file/foo&#39;])

  Or if you wanted to ensure that no users used the &#39;/bin/barsh&#39; shell,
  you could use:

      validate_augeas($passwdcontent, &#39;Passwd.lns&#39;, [&#39;$file/*[shell=&quot;/bin/barsh&quot;]&#39;]

  If a fourth argument is specified, this will be the error message raised and
  seen by the user.

  A helpful error message can be returned like this:

      validate_augeas($sudoerscontent, &#39;Sudoers.lns&#39;, [], &#39;Failed to validate sudoers content with Augeas&#39;)

</span><span class='heredoc_end'>  ENDHEREDOC
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ParseError</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>validate_augeas(): this function requires the augeas feature. See http://docs.puppetlabs.com/guides/augeas.html#pre-requisites for how to activate it.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>2</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>4</span><span class='rparen'>)</span> <span class='kw'>then</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ParseError</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>validate_augeas(): wrong number of arguments (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'>; must be 2, 3, or 4)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>validate_augeas(): Failed to validate content against </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>augeas</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_aug'>aug</span> <span class='op'>=</span> <span class='const'>Augeas</span><span class='op'>::</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='const'>Augeas</span><span class='op'>::</span><span class='const'>NO_MODL_AUTOLOAD</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>

    <span class='comment'># Test content in a temporary file
</span>    <span class='id identifier rubyid_tmpfile'>tmpfile</span> <span class='op'>=</span> <span class='const'>Tempfile</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>validate_augeas</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_tmpfile'>tmpfile</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_tmpfile'>tmpfile</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>

    <span class='comment'># Check for syntax
</span>    <span class='id identifier rubyid_lens'>lens</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_aug'>aug</span><span class='period'>.</span><span class='id identifier rubyid_transform'>transform</span><span class='lparen'>(</span>
      <span class='symbol'>:lens</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_lens'>lens</span><span class='comma'>,</span>
      <span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Validate_augeas</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='symbol'>:incl</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_tmpfile'>tmpfile</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span>
    <span class='rparen'>)</span>
    <span class='id identifier rubyid_aug'>aug</span><span class='period'>.</span><span class='id identifier rubyid_load!'>load!</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_aug'>aug</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/augeas/files</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tmpfile'>tmpfile</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'>//error</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_error'>error</span> <span class='op'>=</span> <span class='id identifier rubyid_aug'>aug</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/augeas/files</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tmpfile'>tmpfile</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'>//error/message</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> with error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ParseError</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># Launch unit tests
</span>    <span class='id identifier rubyid_tests'>tests</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_aug'>aug</span><span class='period'>.</span><span class='id identifier rubyid_defvar'>defvar</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/files</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tmpfile'>tmpfile</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_tests'>tests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> testing path </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ParseError</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_aug'>aug</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>end</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_aug'>aug</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='id identifier rubyid_tmpfile'>tmpfile</span><span class='period'>.</span><span class='id identifier rubyid_unlink'>unlink</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  </table>
</div>

</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>