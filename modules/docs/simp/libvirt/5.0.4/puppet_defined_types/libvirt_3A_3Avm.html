<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Defined Type: libvirt::vm
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_defined_types::libvirt::vm";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_defined_type_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (l)</a> &raquo;
    <span class='title'><span class='object_link'>Defined Types</span></span>
     &raquo; 
    <span class="title">libvirt::vm</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Defined Type: libvirt::vm</h1>
<div class="box_info">
  <dl>
    <dt>Defined in:</dt>
    <dd>
      /tmp/tmp_git_repo20171214-12245-ryuqq1/manifests/vm.pp
    </dd>
  </dl>
</div>

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    <p>The options in the vm_create() define use the exact same field syntax as
the virt-install command.</p>

<p>See virt-install(1) for variable details.</p>

<p>If virbr0 doesn’t do what you need it to, you may need to set up your own
bridge using the networking module.
If you do set up your own bridge, make sure your call of this define
‘require’s that network stanza.</p>

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>libvirt::vm_create { &#39;test_system&#39;:
   mac_addr =&gt; &#39;AA:BB:CC:DD:EE:FF&#39;,
   size =&gt; &#39;20&#39;,
   networks =&gt; { &#39;type&#39; =&gt; &#39;bridge&#39;, target =&gt;  &#39;br0&#39; },
   pxe =&gt; true,
   disk_opts =&gt; { &#39;bus&#39; =&gt; &#39;virtio&#39; }
}</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'></span>
      
      
      
        &mdash;
        <div class='inline'><p>Used to name the /usr/sbin/vm-create script
No ‘/’ in the name!</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>size</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>mac_addr</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>sparse</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>mem</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>512</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>arch</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>machine</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>ostype</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;linux&#39;</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>osvariant</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;rhel6&#39;</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>bridge</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;virbr0&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>A legacy option for connecting to a single bridge. ‘$bridges’ is now the
favored option.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>networks</span>
      
      
        <span class='type'>(<tt>Optional[Array]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>An array of hashes of networks where you can specify both the mac and
model of each network if desired.</p>

<p>This option overrides ‘$bridge’</p>

<p>Example:
  [
    {
      ‘type’    =&gt; ‘bridge’,
      ‘target’  =&gt; ‘<bridge>',
      'mac'     =&gt; '<macaddr>', # Optional
      'model'   =&gt; '<model>', # Optional
    },
    {
      'type'    =&gt; 'network'
      'target'  =&gt; '<network1>',
      'mac'     =&gt; '<macaddr>', # Optional
      'model'   =&gt; '<model>', # Optional
    }
  ]</model></macaddr></network1></model></macaddr></bridge></p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>vcpus</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>vcpu_options</span>
      
      
        <span class='type'>(<tt>Optional[Hash]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>A hash of options that match the vcpus extended arguments.
Options will be passed directly and without translation.
Example:
  { ‘maxvcpus’ =&gt; ‘3’, ‘sockets’ =&gt; ‘2’ }</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>numatune</span>
      
      
        <span class='type'>(<tt>Optional[Hash]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>A hash of options that correspond to the numatune options.
Example:
  { ‘nodeset’ =&gt; ‘1,2,3’, ‘mode’ =&gt; ‘preferred’ }</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>cpu</span>
      
      
        <span class='type'>(<tt>Optional[Hash]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>A hash of the ‘cpu’ options:
  {
    ‘name’      =&gt; ‘<cpu_name>',
    'features'  =&gt; ['+<feature>','-<feature>','disable=<feature>']
    'match'     =&gt; <match>
    'vendor'    =&gt; <vendor>
  }</vendor></match></feature></feature></feature></cpu_name></p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>description</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>security</span>
      
      
        <span class='type'>(<tt>Optional[Hash]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>A hash of the ‘security’ options:
  {
    ‘type’  =&gt; ‘<type>'
    'label' =&gt; '<label>'
  }</label></type></p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>cpuset</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>full_virt</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>accelerate</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>sound</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>noapic</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>noacpi</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>pxe</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>cdrom_path</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>location_url</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>This has been overloaded to accept DVD ISO image paths as well.
If the target ends in ‘.iso’ the correct option will be used.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>ks_url</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>target_dir</span>
      
      
        <span class='type'>(<tt>Stdlib::AbsolutePath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;/var/VM&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The directory in which to install the VM.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>disk_bus</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>A legacy option now superseded by ‘$disk_opts’</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>disk_opts</span>
      
      
        <span class='type'>(<tt>Optional[Hash]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>A hash of options as presented to the disk parameter of virt-install
Supported options are:
bus, perms, cache, format, io, error_policy, serial</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>graphics</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{ &#39;type&#39; =&gt; &#39;vnc&#39;, &#39;keymap&#39; =&gt; &#39;en_us&#39; }</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>A hash of options that are passed to the ‘–graphics’ option of
virt-install, see the man page for details.</p>

<p>Example:
{
  ‘type’              =&gt; ‘vnc’,
  ‘port’              =&gt; <port>                     #optional
  'tlsport'           =&gt; <spice tls="" port="">           #optional
  'listen'            =&gt; <listen address="">           #optional
  'keymap'            =&gt; <virtual keymap="">           #optional
  'password'          =&gt; <password>                 #optional
  'passwordvalidto'  =&gt; <expire date="" for="" password=""> #optional
}</expire></password></virtual></listen></spice></port></p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>virt_type</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>host_device</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>watchdog</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{ &#39;model&#39; =&gt; &#39;default&#39; }</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>A hash of options to pass to the watchdog option of virt-install.
Options are ‘model’, and ‘action’(optional)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Trevor Vaughan <a href="mailto:tvaughan@onyxpoint.com">tvaughan@onyxpoint.com</a></p>
</div>
      
    </li>
  
</ul>

</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File '/tmp/tmp_git_repo20171214-12245-ryuqq1/manifests/vm.pp', line 134</span>

define libvirt::vm (
  Integer              $size,
  Optional[String]     $mac_addr     = undef,
  Boolean              $sparse       = false,
  Integer              $mem          = 512,
  Optional[String]     $arch         = undef,
  Optional[String]     $machine      = undef,
  String               $ostype       = &#39;linux&#39;,
  String               $osvariant    = &#39;rhel6&#39;,
  String               $bridge       = &#39;virbr0&#39;,
  Optional[Array]      $networks     = undef,
  Integer              $vcpus        = 1,
  Optional[Hash]       $vcpu_options = undef,
  Optional[Hash]       $numatune     = undef,
  Optional[Hash]       $cpu          = undef,
  Optional[String]     $description  = undef,
  Optional[Hash]       $security     = undef,
  Optional[String]     $cpuset       = undef,
  Boolean              $full_virt    = true,
  Boolean              $accelerate   = true,
  Boolean              $sound        = true,
  Boolean              $noapic       = false,
  Boolean              $noacpi       = false,
  Boolean              $pxe          = false,
  Optional[String]     $cdrom_path   = undef,
  Optional[String]     $location_url = undef,
  Optional[String]     $ks_url       = undef,
  Stdlib::AbsolutePath $target_dir   = &#39;/var/VM&#39;,
  Optional[String]     $disk_bus     = undef,
  Optional[Hash]       $disk_opts    = undef,
  Hash                 $graphics     = { &#39;type&#39; =&gt; &#39;vnc&#39;, &#39;keymap&#39; =&gt; &#39;en_us&#39; },
  Optional[String]     $virt_type    = undef,
  Optional[String]     $host_device  = undef,
  Hash                 $watchdog     = { &#39;model&#39; =&gt; &#39;default&#39; }
) {

  include &#39;libvirt&#39;

  if !defined(File[$target_dir]) {
    exec { &quot;make ${target_dir}&quot;:
      command =&gt; &quot;/bin/mkdir -p -m 2755 ${target_dir}&quot;,
      onlyif  =&gt; &quot;/usr/bin/test ! -d ${target_dir}&quot;,
      notify  =&gt; File[$target_dir]
    }

    file { $target_dir:
      ensure =&gt; &#39;directory&#39;,
      owner  =&gt; &#39;root&#39;,
      group  =&gt; &#39;kvm&#39;,
      mode   =&gt; &#39;2660&#39;
    }
  }

  file { &quot;/usr/local/sbin/vm-create-${name}.sh&quot;:
    owner   =&gt; &#39;root&#39;,
    group   =&gt; &#39;kvm&#39;,
    mode    =&gt; &#39;0750&#39;,
    content =&gt; template(&#39;libvirt/newvm.erb&#39;),
    require =&gt; File[$target_dir]
  }

  if $facts[&#39;operatingsystem&#39;] in [&#39;RedHat&#39;,&#39;CentOS&#39;] {
    $exec_deps = $facts[&#39;operatingsystemmajrelease&#39;] ? {
      &#39;7&#39; =&gt; [
        File[&quot;/usr/local/sbin/vm-create-${name}.sh&quot;],
        Package[&#39;virt-install&#39;],
        Service[&#39;libvirtd&#39;]
      ],
      default =&gt; [
        File[&quot;/usr/local/sbin/vm-create-${name}.sh&quot;],
        Package[&#39;python-virtinst&#39;],
        Service[&#39;libvirtd&#39;]
      ]
    }
  }
  else {
    warning(&quot;${facts[&#39;operatingsystem&#39;]} not yet supported. Current options are RedHat and CentOS.&quot;)
  }

  exec { &quot;vm-create-${name}&quot;:
    command =&gt; &quot;/usr/local/sbin/vm-create-${name}.sh &amp;&quot;,
    onlyif  =&gt; &quot;/usr/bin/virsh domstate ${name}; /usr/bin/test \$? -ne 0&quot;,
    require =&gt; $exec_deps
  }
}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>