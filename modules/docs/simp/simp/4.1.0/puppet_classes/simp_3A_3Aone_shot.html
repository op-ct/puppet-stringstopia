<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: simp::one_shot
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_classes::simp::one_shot";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (s)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">simp::one_shot</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: simp::one_shot</h1>
<div class="box_info">
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      /tmp/tmp_git_repo20171214-12245-m4sj5d/manifests/one_shot.pp
    </dd>
  </dl>
</div>

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    <p>Configure the system to disconnect from the Puppet server once it has
successfully run</p>

<p>This should <em>not</em> be used as part of the standard SIMP runpuppet
configuration</p>

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>enable_user</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Add a one_shot user account that will be able to login to the system</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;simp_one_shot&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The username to use for remote access</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_password</span>
      
      
        <span class='type'>(<tt>Optional[String[8]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The password for the user in <strong>passwd-compatible salted hash</strong> form</p>

<ul>
  <li>NOTE: Either <code>user_password</code> or <code>user_ssh_public_key</code> must be
specified</li>
</ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_uid</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1777</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The UID of the user</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_gid</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$user_uid</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The GID of the user</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_home</span>
      
      
        <span class='type'>(<tt>Pattern['^/']</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;/var/local/${user_name}&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The full path to the user’s home directory</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_ssh_authorized_key</span>
      
      
        <span class='type'>(<tt>Optional[String[1]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The SSH authorized key for the user</p>

<ul>
  <li>See the native <code>ssh_authorized_key</code> resource definition for details</li>
</ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_ssh_authorized_key_type</span>
      
      
        <span class='type'>(<tt>String[1]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;ssh-rsa&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The type of the SSH authorized key for the user</p>

<ul>
  <li>See the native <code>ssh_authorized_key</code> resource definition for details</li>
</ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_sudo_users</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;root&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The users that the <code>username</code> user may escalate to</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_sudo_commands</span>
      
      
        <span class='type'>(<tt>Array[String[1]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[&#39;ALL&#39;]</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The commands that the <code>username</code> user is allowed to execute via sudo as one
of the allowed users</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_passwordless_sudo</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Allow the user to use passwordless <code>sudo</code></p>

<ul>
  <li>If not set, the <code>user_password</code> must be specified</li>
</ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_allowed_from</span>
      
      
        <span class='type'>(<tt>Array[String[1]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[&#39;ALL&#39;]</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The <code>pam_access</code> compatible locations that the user will be logging in
from</p>

<ul>
  <li>Set to <code>['ALL']</code> to allow from any location</li>
</ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>finalize_dry_run</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Run the finalization script in ‘dry run’ mode and only print what would
have been done</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>finalize_remove_pki</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Remove the SIMP installed host PKI certificates</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>finalize_remove_puppet</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Remove the puppet packages from the system during finalization</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>finalize_remove_script</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Remove the finalization script itself from the system</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Trevor Vaughan <a href="mailto:tvaughan@onyxpoint.com">tvaughan@onyxpoint.com</a></p>
</div>
      
    </li>
  
</ul>

</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File '/tmp/tmp_git_repo20171214-12245-m4sj5d/manifests/one_shot.pp', line 71</span>

class simp::one_shot (
  Boolean             $enable_user                  = true,
  String              $user_name                    = &#39;simp_one_shot&#39;,
  Optional[String[8]] $user_password                = undef,
  Integer             $user_uid                     = 1777,
  Integer             $user_gid                     = $user_uid,
  Pattern[&#39;^/&#39;]       $user_home                    = &quot;/var/local/${user_name}&quot;,
  Optional[String[1]] $user_ssh_authorized_key      = undef,
  String[1]           $user_ssh_authorized_key_type = &#39;ssh-rsa&#39;,
  String              $user_sudo_users              = &#39;root&#39;,
  Boolean             $user_passwordless_sudo       = false,
  Array[String[1]]    $user_sudo_commands           = [&#39;ALL&#39;],
  Array[String[1]]    $user_allowed_from            = [&#39;ALL&#39;],
  Boolean             $finalize_dry_run             = false,
  Boolean             $finalize_remove_pki          = false,
  Boolean             $finalize_remove_puppet       = true,
  Boolean             $finalize_remove_script       = true
) {

  include &#39;simplib::stages&#39;

  if $enable_user {
    unless ($user_password or $user_ssh_authorized_key) {
      fail(&quot;You must specify either &#39;simp::one_shot::user_password&#39; or &#39;simp::one_shot::user_ssh_authorized_key&#39;&quot;)
    }
  }

  contain &#39;simp::one_shot::user&#39;

  # Handle VMWare systems on EL6
  if ($facts[&#39;virtual&#39;] == &#39;vmware&#39;) and ($facts[&#39;os&#39;][&#39;name&#39;] in [&#39;CentOS&#39;,&#39;RedHat&#39;]) and (versioncmp($facts[&#39;os&#39;][&#39;release&#39;][&#39;major&#39;], &#39;6&#39;) == 1) {
    service { &#39;vmtoolsd&#39;:
      ensure =&gt; &#39;running&#39;,
      enable =&gt; true
    }
  }

  # The last of the last
  #
  # This ensures that *any* failures that happen in the previous stages will
  # prevent our finalization code from running
  #
  # It&#39;s a best-effort way to ensure that all configuration has been placed
  #
  # The only place where this may have issues is if there are changes that are
  # based on facts that would require an additional run to take effect
  stage { &#39;simp_one_shot_finalization&#39;:
    require =&gt; Stage[&#39;simp_finalize&#39;]
  }

  class { &#39;simp::one_shot::finalize&#39;:
    stage =&gt; &#39;simp_one_shot_finalization&#39;
  }
}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>