<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: simp_logstash::input::syslog
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_classes::simp_logstash::input::syslog";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (s)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">simp_logstash::input::syslog</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: simp_logstash::input::syslog</h1>
<div class="box_info">
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      /tmp/tmp_git_repo20171214-12245-u6n33h/manifests/input/syslog.pp
    </dd>
  </dl>
</div>

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    <p>A Logstash input for unencrypted Syslog messages</p>

<p>Though this class has a great deal repeated with the other input classes,
they remain separate in the event that variables need to be added in the
future for ERB processing.</p>

<p>IPTables NAT rules are modified so that LogStash can run as a normal user
while collecting syslog traffic from other hosts.</p>

<p>This is currently configured as a catch-all type of system. There is no
output filtering. If you need logstash filters or additional inputs/outputs,
you will need to configure them separately.</p>

<p>See simp_logstash::clean if you want to automatically prune your logs to
conserve Elasticsearch storage space.</p>

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>add_field</span>
      
      
        <span class='type'>(<tt>Optional[Hash]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Add a field to an event.
@see https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>codec</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The codec used for input data.
@see https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>enable_metric</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Whether to enable metric logging for this plugin instance.
@see https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>host</span>
      
      
        <span class='type'>(<tt>Optional[Simplib::IP]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;127.0.0.1&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The address upon which to listen.
@see https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;simp_syslog&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Unique ID for this input plugin configuration.
@see https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>lstash_tags</span>
      
      
        <span class='type'>(<tt>Optional[Array[String]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Arbitrary tags for your events.
@see https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>lstash_type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;simp_syslog&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Type field to be added to all syslog events.
@see https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>order</span>
      
      
        <span class='type'>(<tt>Integer[0]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>50</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The relative order within the configuration group. If
omitted, the entries will fall in alphabetical order.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>content</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The content that you wish to have in your filter. If
set, this will override <em>all</em> template contents.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>listen_plain_tcp</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>If set, listen on the default unencrypted
TCP syslog port. Default is true.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>listen_plain_udp</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>If set, listen on the default unencrypted
UDP syslog port. Default is false.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>tcp_port</span>
      
      
        <span class='type'>(<tt>Simplib::Port</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>514</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The port upon which to listen for TCP syslog
connections.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>udp_port</span>
      
      
        <span class='type'>(<tt>Simplib::Port</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>514</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The port upon which to listen for UDP syslog
connections.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>daemon_port</span>
      
      
        <span class='type'>(<tt>Simplib::Port</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>51400</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The port that logstash itself should listen on.
@see https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>proxy_protocol</span>
      
      
        <span class='type'>(<tt>Optional[Boolean]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Whether to support proxy protocol, v1.
@see https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>manage_sysctl</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>If set, this class will manage the following
sysctl variables when the firewall is enabled.
* net.ipv4.conf.all.route_localhost</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Trevor Vaughan <a href="mailto:tvaughan@onyxpoint.com">tvaughan@onyxpoint.com</a></p>
</div>
      
    </li>
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Ralph Wright <a href="mailto:rwright@onyxpoint.com">rwright@onyxpoint.com</a></p>
</div>
      
    </li>
  
</ul>

</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File '/tmp/tmp_git_repo20171214-12245-u6n33h/manifests/input/syslog.pp', line 71</span>

class simp_logstash::input::syslog (
  Optional[Hash]          $add_field        = undef,
  Optional[String]        $codec            = undef,
  Optional[Boolean]       $enable_metric    = undef,
  Optional[Simplib::IP]   $host             = &#39;127.0.0.1&#39;,
  Optional[String]        $id               = &#39;simp_syslog&#39;,
  Optional[Array[String]] $lstash_tags      = undef,
  String                  $lstash_type      = &#39;simp_syslog&#39;,
  Integer[0]              $order            = 50,
  Optional[String]        $content          = undef,
  Boolean                 $listen_plain_tcp = true,
  Boolean                 $listen_plain_udp = false,
  Simplib::Port           $tcp_port         = 514,
  Simplib::Port           $udp_port         = 514,
  Simplib::Port           $daemon_port      = 51400,
  Optional[Boolean]       $proxy_protocol   = undef,
  Boolean                 $manage_sysctl    = true
) {

  ### Common material to all inputs
  include &#39;::simp_logstash&#39;

  $_component_name = &#39;syslog&#39;
  $_group = &#39;input&#39;
  $_group_order = $::simp_logstash::config_order[$_group]

  if empty($content) {
    $_content = template(&quot;${module_name}/${_group}/${_component_name}.erb&quot;)
  }
  else {
    $_content = $content
  }

  file { &quot;${::simp_logstash::config_prefix}-${_group_order}_${_group}-${order}-${_component_name}${::simp_logstash::config_suffix}&quot;:
    ensure  =&gt; &#39;file&#39;,
    owner   =&gt; &#39;root&#39;,
    group   =&gt; $::logstash::logstash_group,
    mode    =&gt; &#39;0640&#39;,
    content =&gt; $_content,
    notify  =&gt; Class[&#39;logstash::service&#39;]
  }
  ### End common material

  include &#39;simp_logstash::filter::simp_syslog&#39;

  if $::simp_logstash::firewall {
    include &#39;::iptables&#39;

    if $listen_plain_tcp or $listen_plain_udp {
      if $listen_plain_tcp {
        # IPTables rules so that LogStash doesn&#39;t have to run as root.
        iptables_rule { &#39;tcp_logstash_syslog_redirect&#39;:
          table    =&gt; &#39;nat&#39;,
          absolute =&gt; true,
          first    =&gt; true,
          order    =&gt; &#39;1&#39;,
          header   =&gt; false,
          content  =&gt; &quot;-A PREROUTING -p tcp -m tcp --dport ${tcp_port} -j DNAT --to-destination ${host}:${daemon_port}&quot;
        }
      }

      if $listen_plain_udp {
        # IPTables rules so that LogStash doesn&#39;t have to run as root.
        iptables_rule { &#39;udp_logstash_syslog_redirect&#39;:
          table    =&gt; &#39;nat&#39;,
          absolute =&gt; true,
          first    =&gt; true,
          order    =&gt; &#39;1&#39;,
          header   =&gt; false,
          content  =&gt; &quot;-A PREROUTING -p udp -m udp --dport ${udp_port} -j DNAT --to-destination ${host}:${daemon_port}&quot;
        }
      }

      if $manage_sysctl {
        # Allow the iptables NAT rules to work properly.
        sysctl { &#39;net.ipv4.conf.all.route_localnet&#39;:
          ensure =&gt; &#39;present&#39;,
          val    =&gt; &#39;1&#39;
        }
      }
    }

    if $listen_plain_tcp {
      iptables::listen::tcp_stateful { &#39;logstash_syslog_tcp&#39;:
        trusted_nets =&gt; $simp_logstash::trusted_nets,
        dports       =&gt; $tcp_port
      }
      iptables_rule { &#39;logstash_syslog_tcp_allow&#39;:
        content =&gt; &quot;-d ${host} -p tcp -m tcp -m multiport --dports ${daemon_port} -j ACCEPT&quot;
      }
    }
    if $listen_plain_udp {
      iptables::listen::udp { &#39;logstash_syslog_udp&#39;:
        trusted_nets =&gt; $simp_logstash::trusted_nets,
        dports       =&gt; $udp_port
      }
      iptables_rule { &#39;logstash_syslog_udp_allow&#39;:
        content =&gt; &quot;-d ${host} -p udp -m udp -m multiport --dports ${daemon_port} -j ACCEPT&quot;
      }
    }
  }
}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>