<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Function: simplib::rand_cron (Ruby 4.x API)
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_functions_ruby4x::simplib::rand_cron";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_function_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (s)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Functions</span></span>
     &raquo; 
    <span class="title">simplib::rand_cron</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Function: simplib::rand_cron</h1>
<div class="box_info">
  <dl>
    <dt>Defined in:</dt>
    <dd>
      lib/puppet/functions/simplib/rand_cron.rb<span class="defines">,<br />
      /tmp/tmp_git_repo20171214-12245-rji9kl/lib/puppet/functions/simplib/rand_cron.rb</div>
      
    </dd>
  </dl>
  <dl>
    <dt>Function type:</dt>
    <dd>Ruby 4.x API</dd>
  </dl>
</div>

<h2>Overview</h2>
<div class="method_details first">
  
  <div class="tags overload overload_item">
    <span class="overload">
      <span class="overload_item">
        <span class="signature first" style="margin-left: 0px;"><strong>simplib::rand_cron(String $modifier, RandCronAlgorithm $algorithm, Optional[Integer[1]] $occurs, Optional[Integer[1]] $max_value)</strong> &#x21d2; <tt>Array[Integer]</tt> </span>
      </span>
    </span>
  </div>
  
  <div class="docstring">
    <div class="discussion">
      <p>Transforms an input string to one or more interval values for <code>cron</code>.
 This can be used to avoid starting a certain cron job at the same
 time on all servers.</p>

    </div>
  </div>
  <div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Generate one value for the <code>minute</code> cron interval using</p>
</div></p>
      
      <pre class="example code"><code>the &#39;sha256&#39; algorithm

rand_cron(&#39;myhost.test.local&#39;,&#39;sha256&#39;)</code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Generate 2 values for the <code>minute</code> cron interval using</p>
</div></p>
      
      <pre class="example code"><code>the &#39;sha256&#39; algorithm applied to the numeric representation of
an IP

rand_cron(&#39;10.0.23.45&#39;, &#39;sha256&#39;)</code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Generate 2 values for the <code>hour</code> cron interval, using the</p>
</div></p>
      
      <pre class="example code"><code>&#39;ip_mod&#39; algorithm

rand_cron(&#39;10.0.6.78&#39;, &#39;ip_mod&#39;, 2, 23)</code></pre>
    
  </div>

<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>modifier</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The input string to use as the basis for the generated values.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>algorithm</span>
      
      
        <span class='type'>(<tt>RandCronAlgorithm</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Randomization algorithm to apply to transform the input string.</p>

<p>When ‘sha256’, a random number generated from the input string
via sha256 is used as the basis for the returned values.
If the input string is an IP address, this algorithm works well to
create cron job intervals for multiple hosts, when the number
of hosts is less than the <code>max_value</code> or the hosts do not have
linearly-assigned IP addresses.</p>

<p>When ‘ip_mod’ and the input string is an IP address, the modulus
of the numeric IP is used as the basis for the returned values.
This algorithm works well to create cron job intervals for
multiple hosts, when the number of hosts exceeds the <code>max_value</code>
and the hosts have linearly-assigned IP addresses.</p>

<p>When ‘ip_mod’ and the input string is not an IP address, for
backward compatibility,  the crc32 of the input string will
be used as the basis for the returned values.</p>

<p>When ‘crc32’, the crc32 of the input string will be used as the
basis for the returned values.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>occurs</span>
      
      
        <span class='type'>(<tt>Optional[Integer[1]]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The occurrence within an interval, i.e., the number of values to
be generated for the interval. Defaults to <code>1</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>max_value</span>
      
      
        <span class='type'>(<tt>Optional[Integer[1]]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The maximum value for the interval.  The values generated will
be in the inclusive range [0, max_value]. Defaults to <code>60</code> for
use in the <code>minute</code> cron field.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array[Integer]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of integers suitable for use in the
<code>minute</code> or <code>hour</code> cron field.</p>
</div>
      
    </li>
  
</ul>

</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'lib/puppet/functions/simplib/rand_cron.rb', line 5</span>

<span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Functions</span><span class='period'>.</span><span class='id identifier rubyid_create_function'>create_function</span><span class='lparen'>(</span><span class='symbol'>:simplib::rand_cron</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>

  <span class='id identifier rubyid_local_types'>local_types</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_type'>type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RandCronAlgorithm = Enum[&#39;crc32&#39;, &#39;ip_mod&#39;, &#39;sha256&#39;]</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># @param modifier
</span>  <span class='comment'>#   The input string to use as the basis for the generated values.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param algorithm
</span>  <span class='comment'>#   Randomization algorithm to apply to transform the input string.
</span>  <span class='comment'>#
</span>  <span class='comment'>#   When &#39;sha256&#39;, a random number generated from the input string
</span>  <span class='comment'>#   via sha256 is used as the basis for the returned values.
</span>  <span class='comment'>#   If the input string is an IP address, this algorithm works well to
</span>  <span class='comment'>#   create cron job intervals for multiple hosts, when the number
</span>  <span class='comment'>#   of hosts is less than the `max_value` or the hosts do not have
</span>  <span class='comment'>#   linearly-assigned IP addresses.
</span>  <span class='comment'>#
</span>  <span class='comment'>#   When &#39;ip_mod&#39; and the input string is an IP address, the modulus
</span>  <span class='comment'>#   of the numeric IP is used as the basis for the returned values.
</span>  <span class='comment'>#   This algorithm works well to create cron job intervals for
</span>  <span class='comment'>#   multiple hosts, when the number of hosts exceeds the `max_value`
</span>  <span class='comment'>#   and the hosts have linearly-assigned IP addresses.
</span>  <span class='comment'>#
</span>  <span class='comment'>#   When &#39;ip_mod&#39; and the input string is not an IP address, for
</span>  <span class='comment'>#   backward compatibility,  the crc32 of the input string will
</span>  <span class='comment'>#   be used as the basis for the returned values.
</span>  <span class='comment'>#
</span>  <span class='comment'>#   When &#39;crc32&#39;, the crc32 of the input string will be used as the
</span>  <span class='comment'>#   basis for the returned values.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param occurs
</span>  <span class='comment'>#   The occurrence within an interval, i.e., the number of values to
</span>  <span class='comment'>#   be generated for the interval. Defaults to `1`.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param max_value
</span>  <span class='comment'>#   The maximum value for the interval.  The values generated will
</span>  <span class='comment'>#   be in the inclusive range [0, max_value]. Defaults to `60` for
</span>  <span class='comment'>#   use in the `minute` cron field.
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Array[Integer]] Array of integers suitable for use in the
</span>  <span class='comment'>#   ``minute`` or ``hour`` cron field.
</span>  <span class='comment'>#
</span>  <span class='comment'># @example Generate one value for the `minute` cron interval using
</span>  <span class='comment'>#   the &#39;sha256&#39; algorithm
</span>  <span class='comment'>#
</span>  <span class='comment'>#   rand_cron(&#39;myhost.test.local&#39;,&#39;sha256&#39;)
</span>  <span class='comment'>#
</span>  <span class='comment'># @example Generate 2 values for the `minute` cron interval using
</span>  <span class='comment'>#   the &#39;sha256&#39; algorithm applied to the numeric representation of
</span>  <span class='comment'>#   an IP
</span>  <span class='comment'>#
</span>  <span class='comment'>#   rand_cron(&#39;10.0.23.45&#39;, &#39;sha256&#39;)
</span>  <span class='comment'>#
</span>  <span class='comment'># @example Generate 2 values for the `hour` cron interval, using the
</span>  <span class='comment'>#   &#39;ip_mod&#39; algorithm
</span>  <span class='comment'>#
</span>  <span class='comment'>#   rand_cron(&#39;10.0.6.78&#39;, &#39;ip_mod&#39;, 2, 23)
</span>  <span class='comment'>#
</span>  <span class='id identifier rubyid_dispatch'>dispatch</span> <span class='symbol'>:rand_cron</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_required_param'>required_param</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>String</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>            <span class='symbol'>:modifier</span>
    <span class='id identifier rubyid_required_param'>required_param</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RandCronAlgorithm</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:algorithm</span>
    <span class='id identifier rubyid_optional_param'>optional_param</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Integer[1]</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>        <span class='symbol'>:occurs</span>
    <span class='id identifier rubyid_optional_param'>optional_param</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Integer[1]</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>        <span class='symbol'>:max_value</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_generate_crc32_number'>generate_crc32_number</span><span class='lparen'>(</span><span class='id identifier rubyid_input_string'>input_string</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>zlib</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'>Zlib</span><span class='period'>.</span><span class='id identifier rubyid_crc32'>crc32</span><span class='lparen'>(</span><span class='id identifier rubyid_input_string'>input_string</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_generate_ip_mod_number'>generate_ip_mod_number</span><span class='lparen'>(</span><span class='id identifier rubyid_input_string'>input_string</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ipaddr</span><span class='tstring_end'>&#39;</span></span>

    <span class='id identifier rubyid_ip_num'>ip_num</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>begin</span>
     <span class='id identifier rubyid_ip_num'>ip_num</span> <span class='op'>=</span> <span class='const'>IPAddr</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_input_string'>input_string</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='kw'>rescue</span> <span class='const'>IPAddr</span><span class='op'>::</span><span class='const'>Error</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_num'>num</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_ip_num'>ip_num</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='comment'># crc32 calculation for backward compatibility
</span>      <span class='id identifier rubyid_num'>num</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_crc32_number'>generate_crc32_number</span><span class='lparen'>(</span><span class='id identifier rubyid_input_string'>input_string</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_num'>num</span> <span class='op'>=</span> <span class='id identifier rubyid_ip_num'>ip_num</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_num'>num</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_generate_sha256_number'>generate_sha256_number</span><span class='lparen'>(</span><span class='id identifier rubyid_input_string'>input_string</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>digest</span><span class='tstring_end'>&#39;</span></span>

    <span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA256</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id identifier rubyid_input_string'>input_string</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span>
  <span class='kw'>end</span>

  <span class='comment'># @param modifier Input string to be transformed to an Integer
</span>  <span class='comment'># @param algorithm Algorithm to apply to transform input string into
</span>  <span class='comment'>#   an Integer
</span>  <span class='comment'>#
</span>  <span class='comment'># @return Integer to be used as a basis for generated cron values
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_generate_numeric_modifier'>generate_numeric_modifier</span><span class='lparen'>(</span><span class='id identifier rubyid_modifier'>modifier</span><span class='comma'>,</span> <span class='id identifier rubyid_algorithm'>algorithm</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_eval'>eval</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>generate_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='embexpr_end'>}</span><span class='tstring_content'>_number(modifier)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_rand_cron'>rand_cron</span><span class='lparen'>(</span><span class='id identifier rubyid_modifier'>modifier</span><span class='comma'>,</span> <span class='id identifier rubyid_algorithm'>algorithm</span><span class='comma'>,</span> <span class='id identifier rubyid_occurs'>occurs</span> <span class='op'>=</span> <span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_max_value'>max_value</span> <span class='op'>=</span> <span class='int'>59</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_range_modifier'>range_modifier</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_numeric_modifier'>generate_numeric_modifier</span><span class='lparen'>(</span><span class='id identifier rubyid_modifier'>modifier</span><span class='comma'>,</span> <span class='id identifier rubyid_algorithm'>algorithm</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_modulus'>modulus</span> <span class='op'>=</span> <span class='id identifier rubyid_max_value'>max_value</span> <span class='op'>+</span> <span class='int'>1</span>
    <span class='id identifier rubyid_base'>base</span> <span class='op'>=</span> <span class='id identifier rubyid_range_modifier'>range_modifier</span> <span class='op'>%</span> <span class='id identifier rubyid_modulus'>modulus</span>

    <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_occurs'>occurs</span> <span class='op'>==</span> <span class='int'>1</span>
      <span class='id identifier rubyid_values'>values</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_base'>base</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_occurs'>occurs</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
        <span class='id identifier rubyid_values'>values</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='id identifier rubyid_modulus'>modulus</span> <span class='op'>/</span> <span class='id identifier rubyid_occurs'>occurs</span> <span class='op'>*</span> <span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='id identifier rubyid_modulus'>modulus</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  </table>
</div>

</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>